<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
sampler-section

@element sampler-section
@homepage github.io
-->

<link rel="import" href="../polymer/polymer.html">

<polymer-element name="sampler-section" attributes="label tag src active">
<template>

  <style>
  
    :host {
      display: block;
    }
  
    iframe {
      display: block;
      width: 100%;
      min-height: 500px;
      border: none;
    }
  
  </style>

  <content></content>

  <div id="frameContainer">
  
    <template if="{{src && active || loaded}}">
    
      <iframe src="{{src}}" on-load="{{frameLoaded}}"></iframe>
    
    </template>
    
  </div>  

</template>
<script>

  Polymer('sampler-section', {
    
    active: false,
    
    loaded: false,
    
    observe: {
      active: 'updateFrameHeight'
    },
    
    ready: function() {
      window.addEventListener('resize', this.updateFrameHeight.bind(this));
    },
    
    get frame() {
      return this.$.frameContainer.querySelector('iframe');
    },
    
    frameLoaded: function() {
      this.loaded = true;
      this.frame.contentWindow.addEventListener('polymer-ready', function() {
        setTimeout(this.updateFrameHeight.bind(this), 100);
      }.bind(this));
    },
    
    updateFrameHeight: function() {
      var frame = this.frame;
      if (frame && frame.contentDocument && frame.contentDocument.body) {
        var body = frame.contentDocument.body;
        frame.style.height = 'auto';
        frame.style.height = body.scrollHeight + 'px';
        // to avoid the 'blinking bug'
        // https://code.google.com/p/chromium/issues/detail?id=332024
        body.style.webkitTransform = body.style.transform = 'translateZ(0)';
      }
    }
    
  });

</script>
</polymer-element>
